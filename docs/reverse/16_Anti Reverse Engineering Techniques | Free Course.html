<!DOCTYPE html>
<html prefix="og: https://ogp.me/ns#" class="jetpack-lazy-images-js-enabled" slick-uniqueid="3" lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="profile" href="http://gmpg.org/xfn/11"><link rel="pingback" href="https://liberoscarcelli.net/xmlrpc.php"><link type="text/css" media="all" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/wpsol_14be2f250a3ed71a9d4ad1d7501cb78f.css" rel="stylesheet"><title>Anti Reverse Engineering Techniques | Free Course</title><meta name="description" content="Overview of the most commonly used anti reverse engineering techniques."> <script type="application/ld+json" class="aioseop-schema">{"@context":"https://schema.org","@graph":[{"@type":["Person","Organization"],"@id":"https://liberoscarcelli.net/#person","url":"https://liberoscarcelli.net/","name":"admin","sameAs":[]},{"@type":"WebSite","@id":"https://liberoscarcelli.net/#website","url":"https://liberoscarcelli.net/","name":"Free Technology Courses","publisher":{"@id":"https://liberoscarcelli.net/#person"},"potentialAction":{"@type":"SearchAction","target":"https://liberoscarcelli.net/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#webpage","url":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/","inLanguage":"en-US","name":"Anti Reverse Engineering Techniques","isPartOf":{"@id":"https://liberoscarcelli.net/#website"},"breadcrumb":{"@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#breadcrumblist"},"image":{"@type":"ImageObject","@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#primaryimage","url":"https://i0.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/ReverseEngineering_CourseLogo.jpg?fit=1280%2C720&ssl=1","width":1280,"height":720,"caption":"Reverse Engineering Course Logo"},"primaryImageOfPage":{"@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#primaryimage"},"datePublished":"2020-02-23T15:23:39+00:00","dateModified":"2020-04-09T09:57:20+00:00","description":"Overview of the most commonly used anti reverse engineering techniques."},{"@type":"BreadcrumbList","@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#breadcrumblist","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://liberoscarcelli.net/","url":"https://liberoscarcelli.net/","name":"Free Technology Courses"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://liberoscarcelli.net/courses/","url":"https://liberoscarcelli.net/courses/","name":"Courses"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://liberoscarcelli.net/courses/reverse-engineering/","url":"https://liberoscarcelli.net/courses/reverse-engineering/","name":"Reverse Engineering"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/","url":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/","name":"Beginners"}},{"@type":"ListItem","position":5,"item":{"@type":"WebPage","@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/","url":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/","name":"Reverse Engineering For Beginners"}},{"@type":"ListItem","position":6,"item":{"@type":"WebPage","@id":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/","url":"https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/","name":"Anti Reverse Engineering Techniques"}}]}]}</script> <link rel="canonical" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/"><meta property="og:type" content="website"><meta property="og:title" content="Anti Reverse Engineering Techniques"><meta property="og:description" content="Overview of the most commonly used anti reverse engineering techniques."><meta property="og:url" content="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/"><meta property="og:site_name" content="Free Technology Courses"><meta property="og:image" content="https://i0.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/ReverseEngineering_CourseLogo.jpg?fit=863%2C485&amp;ssl=1"><meta property="fb:admins" content="100011056717585"><meta property="og:image:secure_url" content="https://i0.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/ReverseEngineering_CourseLogo.jpg?fit=863%2C485&amp;ssl=1"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Anti Reverse Engineering Techniques"><meta name="twitter:description" content="Overview of the most commonly used anti reverse engineering techniques."><meta name="twitter:image" content="https://i0.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/ReverseEngineering_CourseLogo.jpg?fit=863%2C485&amp;ssl=1"><link rel="dns-prefetch" href="https://fonts.googleapis.com/"><link rel="dns-prefetch" href="https://s.w.org/"><link rel="stylesheet" id="wp-block-library-css" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/style.css" type="text/css" media="all"><link rel="stylesheet" id="genericons-css" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/genericons.css" type="text/css" media="all"><link rel="stylesheet" id="colinear-open-sans-lora-css" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/css_002.css" type="text/css" media="all"><link rel="stylesheet" id="colinear-inconsolata-css" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/css.css" type="text/css" media="all"><link rel="stylesheet" id="social-logos-css" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/social-logos.css" type="text/css" media="all"><link rel="stylesheet" id="jetpack_css-css" href="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/jetpack.css" type="text/css" media="all"> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/jquery.js"></script> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/jquery-migrate.js"></script> <link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://liberoscarcelli.net/xmlrpc.php?rsd"><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://liberoscarcelli.net/wp-includes/wlwmanifest.xml"><meta name="generator" content="WordPress 5.4"><link rel="shortlink" href="https://liberoscarcelli.net/?p=1163"><link rel="alternate" type="application/json+oembed" href="https://liberoscarcelli.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fliberoscarcelli.net%2Fcourses%2Freverse-engineering%2Fbeginners%2Freverse-engineering-for-beginners%2Fanti-reverse-engineering-techniques%2F"><link rel="alternate" type="text/xml+oembed" href="https://liberoscarcelli.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fliberoscarcelli.net%2Fcourses%2Freverse-engineering%2Fbeginners%2Freverse-engineering-for-beginners%2Fanti-reverse-engineering-techniques%2F&amp;format=xml"><link rel="dns-prefetch" href="https://i0.wp.com/"><link rel="dns-prefetch" href="https://i1.wp.com/"><link rel="dns-prefetch" href="https://i2.wp.com/"><link rel="dns-prefetch" href="https://c0.wp.com/"><link rel="dns-prefetch" href="https://v0.wordpress.com/"><link rel="dns-prefetch" href="https://jetpack.wordpress.com/"><link rel="dns-prefetch" href="https://s0.wp.com/"><link rel="dns-prefetch" href="https://s1.wp.com/"><link rel="dns-prefetch" href="https://s2.wp.com/"><link rel="dns-prefetch" href="https://public-api.wordpress.com/"><link rel="dns-prefetch" href="https://0.gravatar.com/"><link rel="dns-prefetch" href="https://1.gravatar.com/"><link rel="dns-prefetch" href="https://2.gravatar.com/"><link rel="icon" href="https://i1.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/cropped-Logo.jpg?fit=32%2C32&amp;ssl=1" sizes="32x32"><link rel="icon" href="https://i1.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/cropped-Logo.jpg?fit=192%2C192&amp;ssl=1" sizes="192x192"><link rel="apple-touch-icon" href="https://i1.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/cropped-Logo.jpg?fit=180%2C180&amp;ssl=1"><meta name="msapplication-TileImage" content="https://i1.wp.com/liberoscarcelli.net/wp-content/uploads/2020/04/cropped-Logo.jpg?fit=270%2C270&amp;ssl=1"> <script type="text/javascript" defer="defer" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/wpsol_7574191c309d4eaea3c510cfd6cec1ca.js"></script><script src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/wp-emoji-release.js" type="text/javascript" defer="defer"></script></head><body class="page-template-default page page-id-1163 page-child parent-pageid-137 custom-background has-menu has-double-sidebar has-right-left-sidebar"><div id="page" class="hfeed site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="masthead" class="site-header" role="banner"><div class="site-branding"> <a href="https://liberoscarcelli.net/" class="site-logo-link" rel="home" itemprop="url"></a><p class="site-title"><a href="https://liberoscarcelli.net/" rel="home">Free Technology Courses</a></p></div><nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false"><span class="screen-reader-text">Primary Menu</span></button><div class="menu-mainmenu-container"><ul id="primary-menu" class="menu nav-menu" aria-expanded="false"><li id="menu-item-26" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-26"><a href="https://liberoscarcelli.net/">Home</a></li><li id="menu-item-1555" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1555" aria-haspopup="true"><a>Courses</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-1700" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1700" aria-haspopup="true"><a>Operating Systems</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-1701" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1701" aria-haspopup="true"><a>Beginners</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-1702" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1702"><a href="https://liberoscarcelli.net/courses/operating-systems/beginners/embedded-linux/">Embedded Linux</a></li></ul></li></ul></li><li id="menu-item-1566" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1566" aria-haspopup="true"><a>Programming</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-1569" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1569" aria-haspopup="true"><a>Beginners</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-2341" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2341"><a href="https://liberoscarcelli.net/courses/programming/beginners/algorithms-and-data-structures/">Algorithms And Data Structures</a></li><li id="menu-item-1580" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1580"><a href="https://liberoscarcelli.net/courses/programming/beginners/blockchain-for-beginners/">BlockChain For Beginners</a></li></ul></li></ul></li><li id="menu-item-1557" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1557" aria-haspopup="true"><a>Reverse Engineering</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-1572" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1572" aria-haspopup="true"><a>Beginners</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-1574" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-1574"><a href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/">Reverse Engineering For Beginners</a></li></ul></li></ul></li></ul></li><li id="menu-item-2875" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2875"><a href="https://liberoscarcelli.net/blog/">Blog</a></li><li id="menu-item-2878" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-2878" aria-haspopup="true"><a>Info</a><button class="dropdown-toggle" aria-expanded="false"><span class="screen-reader-text">expand child menu</span></button><ul class="sub-menu"><li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879"><a href="https://liberoscarcelli.net/cookie-policy/">Cookie Policy</a></li><li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-2880"><a href="https://liberoscarcelli.net/privacy-policy/">Privacy Policy</a></li><li id="menu-item-2886" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2886"><a href="https://liberoscarcelli.net/contact-us/">Contact us</a></li></ul></li></ul></div></nav></header><div id="content" class="site-content" style="min-height: 447px;"><div id="primary" class="content-area"><main id="main" class="site-main" role="main"><article id="post-1163" class="post-1163 page type-page status-publish has-post-thumbnail hentry"><header class="entry-header"><h1 class="entry-title">Anti Reverse Engineering Techniques</h1></header><div class="entry-content"><p class="has-background has-light-green-cyan-background-color">Anti debugging techniques aim at preventing the program from running in <strong>debug</strong>
 mode, in order to make reverse engineering process more difficult. This
 also makes code obfuscation more effective, as the engineer would not 
be able to navigate the code with the debugger.</p><p class="has-background has-pale-cyan-blue-background-color">On <strong>Linux</strong> platforms, as debuggers such as gdb and strace rely upon the function <strong>ptrace()</strong>
 that can only be called by one process at a time, programmers can have 
the code call ptrace() internally, in order to prevent users from 
opening additional debugging sessions.</p><p class="has-background has-pale-cyan-blue-background-color">On <strong>Linux</strong> systems, the following file contains a list of properties that describe the process identified by [pid]:</p><pre class="EnlighterJSRAW" data-enlighter-language="shell" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="" style="display: none;">/proc/[pid]/status</pre><div class="EnlighterJSWrapper classicEnlighterJSWrapper"><ol class="hoverEnabled classicEnlighterJS EnlighterJS"><li class=" odd"><span class="">/proc/[pid]/status</span></li></ol><pre style="display: none;">/proc/[pid]/status</pre></div><p class="has-background has-pale-cyan-blue-background-color">If
 the process identified by [pid] is being traced, “State” and 
“TracerPID” will be set accordingly. Monitoring these fields does not 
produce reliable results as their behaviour can be controlled and 
modified using several techniques.</p><p class="has-background has-vivid-green-cyan-background-color">On <strong>Windows</strong>
 machines, IsDebuggerPresent is a Kernel32 API function that returns one
 if the program is being debugged. Programmers can protect their 
software by having the code checking on this value, killing the 
execution should the API return one. The following assembly lines 
explain how a programmer can implement this scenario:</p><pre class="EnlighterJSRAW" data-enlighter-language="asm" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="" style="display: none;">xor eax, eax
call IsDebuggerPresent
test eax, eax
jnz exitNow</pre><div class="EnlighterJSWrapper classicEnlighterJSWrapper"><ol class="hoverEnabled classicEnlighterJS EnlighterJS"><li class=" odd"><span class="kw3">xor</span><span class=""> eax, eax</span></li><li class=" even"><span class=""></span><span class="kw3">call</span><span class=""> IsDebuggerPresent</span></li><li class=" odd"><span class=""></span><span class="kw3">test</span><span class=""> eax, eax</span></li><li class=" even"><span class=""></span><span class="kw3">jnz</span><span class=""> exitNow</span></li></ol><pre style="display: none;">xor eax, eax
call IsDebuggerPresent
test eax, eax
jnz exitNow</pre></div><p class="has-background has-vivid-green-cyan-background-color">However,
 techniques based upon IsDebuggerPresent can be easily circumvented by 
opportunely setting breakpoints and by manually resetting the EAX 
register, which prevents the code from jumpimg.</p><p class="has-background has-vivid-green-cyan-background-color">In the <strong>WindowsNT</strong>
 operating system family, the Process Environment Block (PEB) structure 
is strongly linked to the EPROCESS one, which is the process object for 
the process. PEB contains structures that describe processes such as 
startup parameters, the program image base address and much more… PEB 
also contains two fields that can help in identifying whether a process 
is being debugged:</p><ul><li>BeingDebugged is set to 1 if debug is running and found at offset 0x02.</li><li>GlobalNTFlag is set to 0x70 if debug is running and found at offset 0x68.</li></ul><p class="has-background has-vivid-green-cyan-background-color">These two values should be used as follows:</p><ol><li>Store FS:[18] into EAX to grab the TEB address.</li><li>Store DS:[EAX+0x30] into EAX to grab the PEB address.</li><li>Store DS:[EAX+0x68] into EAX to retrieve GlobalNTFlag.</li><li>Compare EAX with 0x70 to check whether debug is on.</li><li>Copy ZF value into AL which should be 0 or 1.</li></ol><p class="has-background has-very-light-gray-background-color">Exceptions can be used to confuse reverse engineers by:</p><ul><li>Accessing inaccessible memory spaces.</li><li>Dividing by zero.</li><li>Using INT 0x01 and INT 0x03 instructions.</li></ul><p class="has-background has-pale-cyan-blue-background-color">The
 stack can be manipulated to confuse the engineer and the reverser, by 
faking a sequence of instructions that mimic function calling 
conventions where no actual function is being called. For example, this 
can be achieved by opportunely using the instructions PUSH, POP and RET.</p><p class="has-background has-vivid-green-cyan-background-color">Moreover,
 a program might be able to figure out whether is being run into a 
debugger by looking at the execution time: any line of code that takes 
longer than expected to complete might indicate that the program is 
being debugged. Again, the programmer can protect packages by stopping a
 program that takes longer than expected to complete its tasks. For 
example, the reader should test the following program passing different 
values to CMP at line 21:</p><pre class="EnlighterJSRAW" data-enlighter-language="asm" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="" style="display: none;">section .text
   global _start
_start:
   ; Get the current timestamp
   rdtsc
   ; Save timestamp into ebx
   mov ebx, eax
   ; Next 8 lines of code do nothing
   mov r8d, 1
   mov r8d, 2
   mov r8d, 3
   mov r8d, 4
   mov r8d, 5
   mov r8d, 6
   mov r8d, 7
   mov r8d, 8
   ; Get final timestamp
   rdtsc
   ; Calculate how long it took
   sub eax, ebx
   cmp eax, 0x1000000
   jg debugIsOn
   jmp terminate
debugIsOn:
   mov rax, 1
   mov rdi, 1
   mov rsi, debugMsg
   mov rdx, msgLen
   syscall  
terminate:
   mov rax, 60
   mov rdi, 0 
   syscall
section .data
   debugMsg db 'Debug might be on'
   msgLen equ $ - debugMsg  </pre><div class="EnlighterJSWrapper classicEnlighterJSWrapper"><ol class="hoverEnabled classicEnlighterJS EnlighterJS"><li class=" odd"><span class="kw3">section</span><span class=""> .text</span></li><li class=" even"><span class="">   </span><span class="kw3">global</span><span class=""> _start</span></li><li class=" odd"><span class=""></span><span class="kw1">_start:</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="co1">; Get the current timestamp</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">rdtsc</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="co1">; Save timestamp into ebx</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> ebx, eax</span></li><li class=" even"><span class="">   </span><span class="co1">; Next 8 lines of code do nothing</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">1</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">2</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">3</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">4</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">5</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">6</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">7</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> r8d, </span><span class="nu0">8</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="co1">; Get final timestamp</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">rdtsc</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="co1">; Calculate how long it took</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">sub</span><span class=""> eax, ebx</span></li><li class=" odd"><span class="">   </span><span class="kw3">cmp</span><span class=""> eax, </span><span class="nu0">0x1000000</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">jg</span><span class=""> debugIsOn</span></li><li class=" odd"><span class="">   </span><span class="kw3">jmp</span><span class=""> terminate</span></li><li class=" even"><span class=""></span><span class="kw1">debugIsOn:</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> rax, </span><span class="nu0">1</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> rdi, </span><span class="nu0">1</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> rsi, debugMsg</span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> rdx, msgLen</span></li><li class=" odd"><span class="">   </span><span class="kw3">syscall</span><span class="">  </span></li><li class=" even"><span class=""></span><span class="kw1">terminate:</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> rax, </span><span class="nu0">60</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> rdi, </span><span class="nu0">0</span><span class=""> </span></li><li class=" odd"><span class="">   </span><span class="kw3">syscall</span><span class=""></span></li><li class=" even"><span class=""></span><span class="kw3">section</span><span class=""> .data</span></li><li class=" odd"><span class="">   </span><span class="kw3">debugMsg</span><span class=""> db </span><span class="st0">'Debug might be on'</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">msgLen</span><span class=""> equ </span><span class="co2">$ - debugMsg  </span></li></ol><pre style="display: none;">section .text
   global _start
_start:
   ; Get the current timestamp
   rdtsc
   ; Save timestamp into ebx
   mov ebx, eax
   ; Next 8 lines of code do nothing
   mov r8d, 1
   mov r8d, 2
   mov r8d, 3
   mov r8d, 4
   mov r8d, 5
   mov r8d, 6
   mov r8d, 7
   mov r8d, 8
   ; Get final timestamp
   rdtsc
   ; Calculate how long it took
   sub eax, ebx
   cmp eax, 0x1000000
   jg debugIsOn
   jmp terminate
debugIsOn:
   mov rax, 1
   mov rdi, 1
   mov rsi, debugMsg
   mov rdx, msgLen
   syscall  
terminate:
   mov rax, 60
   mov rdi, 0 
   syscall
section .data
   debugMsg db 'Debug might be on'
   msgLen equ $ - debugMsg  </pre></div><p class="has-background has-very-light-gray-background-color">Execution of software packages in <strong>virtual</strong> <strong>environments</strong>
 might be disabled by programmers for several reasons, including 
preventing users from breaching the license agreement and preventing 
reverse engineers from running a debugger. As the assembly instruction 
CPUID returns family, model and brand string for the processor, it can 
be used to figure out whether the program is running on a real CPU or a 
hypervisor. However, bear in mind that some hypervisors allow system 
administrators to hide or change values returned by CPUID by simply 
editing a configuration file. The following assembly program makes 
decisions according to specific CPUID values:</p><pre class="EnlighterJSRAW" data-enlighter-language="asm" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="" style="display: none;">section .text
   global _start
_start:
   mov eax, 1
   cpuid
   bt ecx, 31
   jc VMYes
   nop
   nop
VMYes:
   nop

   mov rax, 60
   mov rdi, 0 
   syscall</pre><div class="EnlighterJSWrapper classicEnlighterJSWrapper"><ol class="hoverEnabled classicEnlighterJS EnlighterJS"><li class=" odd"><span class="kw3">section</span><span class=""> .text</span></li><li class=" even"><span class="">   </span><span class="kw3">global</span><span class=""> _start</span></li><li class=" odd"><span class=""></span><span class="kw1">_start:</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> eax, </span><span class="nu0">1</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">cpuid</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">bt</span><span class=""> ecx, </span><span class="nu0">31</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">jc</span><span class=""> VMYes</span></li><li class=" even"><span class="">   </span><span class="kw3">nop</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">nop</span><span class=""></span></li><li class=" even"><span class=""></span><span class="kw1">VMYes:</span><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">nop</span><span class=""></span></li><li class=" even"><span class=""></span></li><li class=" odd"><span class="">   </span><span class="kw3">mov</span><span class=""> rax, </span><span class="nu0">60</span><span class=""></span></li><li class=" even"><span class="">   </span><span class="kw3">mov</span><span class=""> rdi, </span><span class="nu0">0</span><span class=""> </span></li><li class=" odd"><span class="">   syscall</span></li></ol><pre style="display: none;">section .text
   global _start
_start:
   mov eax, 1
   cpuid
   bt ecx, 31
   jc VMYes
   nop
   nop
VMYes:
   nop

   mov rax, 60
   mov rdi, 0 
   syscall</pre></div><p class="has-background has-very-light-gray-background-color">Moreover, programmers can prevent the execution in virtual environments by terminating programs when well known <strong>hosted hypervisors</strong> services are found to be running. For example, the following services should all be monitored:</p><ul><li>vmtoolsd.</li><li>vmacthlp.</li><li>vmwaretray.</li><li>vmwareuser.</li><li>VGAuthService.</li><li>vboxservice.</li><li>vboxtray.</li><li>vboxcontrol.</li><li>qemu-ga.</li><li>vmsrvc.</li><li>vmusrvc.</li><li>Many more…</li></ul><p class="has-background has-very-light-gray-background-color">Programmers
 might also want to scan the file system in order to look for 
directories and files that are known to be created by hosted 
hypervisors:</p><ul><li>system32\drivers\VBoxGuest.sys</li><li>%programfiles%\VMWare</li><li>Many more…</li></ul><p class="has-background has-very-light-gray-background-color">The Windows registry can also be scanned in order to detect any hosted hypervisor installation:</p><ul><li>HKLM\HARDWARE\ACPI\DSDT\VBOX__</li><li>HKLM\HARDWARE\ACPI\FADT\VBOX__</li><li>HKLM\HARDWARE\ACPI\RSDT\VBOX__</li><li>HKLM\SOFTWARE\Oracle\VirtualBox Guest Additions</li><li>Many more…</li></ul><p class="has-background has-very-light-gray-background-color">Moreover,
 programmers may also want to consider the following information and 
terminate the execution of the program at any time:</p><ul><li>Small amount of memory might indicate that a program is running into a virtual machine.</li><li>Single processor machines are usually virtual machines.</li><li>Small disk size might indicate that the program is running into a virtual machine.</li><li>Small screen size might indicate that the program is running into a virtual machine.</li><li>Is any debugger or reverser process running?</li></ul><p class="has-background has-vivid-green-cyan-background-color">Finally, a programmer should always:</p><ul><li>Implement any strategy able to make memory dumps appear confusing to engineers and automated tools.</li><li>Modify PE and ELF sections so that their properties return wrong values.</li><li>Modify PEB sections so that its structures return wrong values.</li></ul><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-1163" class="share-twitter sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/?share=twitter&amp;nb=1" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-1163" class="share-facebook sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/?share=facebook&amp;nb=1" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared="" class="share-reddit sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/?share=reddit&amp;nb=1" target="_blank" title="Click to share on Reddit"><span>Reddit</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared="" class="share-jetpack-whatsapp sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/?share=jetpack-whatsapp&amp;nb=1" target="_blank" title="Click to share on WhatsApp"><span>WhatsApp</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-1163" class="share-linkedin sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/?share=linkedin&amp;nb=1" target="_blank" title="Click to share on LinkedIn"><span>LinkedIn</span></a></li><li class="share-telegram"><a rel="nofollow noopener noreferrer" data-shared="" class="share-telegram sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/?share=telegram&amp;nb=1" target="_blank" title="Click to share on Telegram"><span>Telegram</span></a></li><li class="share-print"><a rel="nofollow noopener noreferrer" data-shared="" class="share-print sd-button no-icon" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#print" target="_blank" title="Click to print"><span>Print</span></a></li><li class="share-end"></li></ul></div></div></div></div><footer class="entry-footer"></footer></article><div id="comments" class="comments-area"><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://liberoscarcelli.net/courses/reverse-engineering/beginners/reverse-engineering-for-beginners/anti-reverse-engineering-techniques/#respond" style="display:none;">Cancel reply</a></small></h3><form id="commentform" class="comment-form"> <iframe title="Comment Form" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/a.html" style="width: 100%; height: 57px; border: 0px none;" name="jetpack_remote_comment" class="jetpack_remote_comment" id="jetpack_remote_comment" sandbox="allow-same-origin allow-top-navigation allow-scripts allow-forms allow-popups" scrolling="no"></iframe> <!--[if !IE]><!--> <!--<![endif]--><input type="hidden" name="js-spam-prevention" value="1d07142f224691100d7d33814349a3c9"></form></div> <input type="hidden" name="comment_parent" id="comment_parent" value=""></div></main></div><div id="secondary" class="widget-area" role="complementary"><div class="left-sidebar"><aside id="mc4wp_form_widget-2" class="widget widget_mc4wp_form_widget"><h2 class="widget-title">Newsletter</h2><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-3032" method="post" data-id="3032" data-name="NewsLetter"><div class="mc4wp-form-fields"><p> <label>Email address: <input type="email" name="EMAIL" placeholder="Your email address" required=""> </label></p><p> <label> <input name="AGREE_TO_TERMS" type="checkbox" value="1" required=""> I am older than 18 years of age and I agree to have my data transferred to MailChimp in accordance with liberoscarcelli.net's <a href="https://liberoscarcelli.net/privacy-policy/" style="color: rgb(6,69,173)" target="_blank">privacy policy</a> </label></p><p> <input type="submit" value="Sign up"></p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" tabindex="-1" autocomplete="off"></label><input type="hidden" name="_mc4wp_timestamp" value="1586938928"><input type="hidden" name="_mc4wp_form_id" value="3032"><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1"><div class="mc4wp-response"></div></form></aside><aside id="blog-stats-2" class="widget blog-stats"><h2 class="widget-title">Blog Stats</h2><ul><li>816 hits</li></ul></aside></div><div class="right-sidebar"><aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://liberoscarcelli.net/"> <label> <span class="screen-reader-text">Search for:</span> <input type="search" class="search-field" placeholder="Search …" name="s"> </label> <input type="submit" class="search-submit screen-reader-text" value="Search"></form></aside><aside id="text-2" class="widget widget_text"><h2 class="widget-title">Copyright</h2><div class="textwidget"><p>Libero
 Scarcelli and liberocarcelli.net ©, 2020. Unauthorized use and/or 
duplication of this material without express and written permission from
 this site’s author and/or owner is strictly prohibited</p></div></aside></div></div></div><div id="tertiary" class="widget-area-footer" role="complementary"><div class="footer-widget"></div></div><footer id="colophon" class="site-footer" role="contentinfo"><div class="site-info"> <a href="https://wordpress.org/">Proudly powered by WordPress</a> <span class="sep genericon genericon-wordpress"></span> Theme: Colinear by <a href="https://wordpress.com/themes/" rel="designer">Automattic</a>.</div></footer></div> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/photon.js"></script> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/comment-reply.js"></script> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/eu-cookie-law.js"></script><aside id="eu_cookie_law_widget-3" class="widget widget_eu_cookie_law_widget top"></aside> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/lazy-images.js"></script> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/wp-embed.js"></script> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/sharing.js"></script> <!--[if IE]> %%SCRIPT3faeacbae74b7b1384d64b7d63b5cfd8%%PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCQlpZiAoIDAgPT09IHdpbmRvdy5sb2NhdGlvbi5oYXNoLmluZGV4T2YoICcjY29tbWVudC0nICkgKSB7CgkJCQkvLyB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCkgZG9lc24ndCByZXNwZWN0IHRoZSBIYXNoIGluIElFCgkJCQl3aW5kb3cubG9jYXRpb24uaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoOwoJCQl9CgkJPC9zY3JpcHQ+%%SCRIPT%% <![endif]--> <script type="text/javascript" src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/e-202016.js" async="async" defer="defer"></script> <script type="text/javascript">_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.4.1',blog:'172909830',post:'1163',tz:'0',srv:'liberoscarcelli.net'} ]);
	_stq.push([ 'clickTrackerInit', '172909830', '1163' ]);</script> 

<img src="16_Anti%20Reverse%20Engineering%20Techniques%20|%20Free%20Course_files/g.gif" alt=":)" id="wpstats" width="6" height="5"></body></html>
<!-- Cache served by WPSOL CACHE - Last modified: Wed, 15 Apr 2020 08:22:08 GMT -->